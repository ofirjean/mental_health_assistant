pipeline {
  agent {
    kubernetes {
      label 'k8s-yaml'
      defaultContainer 'builder'
      yamlFile 'ci/jenkins/build-agents.yaml'
    }
  }
  options {
    skipDefaultCheckout(true)
    timestamps()
    ansiColor('xterm')
  }
  environment {
    IMAGE = 'ofirjean/mental-health-assistant'
    REGISTRY = 'docker.io'
  }
  stages {
    stage('Checkout') {
      steps {
        container('builder') {
          checkout scm
          sh '''
            set -euo pipefail
            git --version
            docker version || true
            python3 --version || true
            echo "Branch: ${BRANCH_NAME:-unknown}"
            echo "Commit: ${GIT_COMMIT:-unknown}"
            ls -la
          '''
        }
      }
    }
    // ... (rest of your stages as before)
  }
  post {
    always {
      echo "Build finished with status: ${currentBuild.currentResult}"
      // DO NOT call cleanWs() unless the Workspace Cleanup plugin is installed
    }
  }
}
